---
title: Руководство по эксплуатации Git-LFS
origin-url: https://gitee.ru/help/articles/4235
slug: /enterprise/code-manage/code-hosting/large-file-manage/git-lfs
---

> > Теперь Gitee (gitee.ru) поддерживает функцию Git-LFS, которая в настоящее время доступна для платных предприятий.

### **Git-LFS**

Git, являющийся лучшим в мире инструментом распределенного контроля версий, также является отличным инструментом управления файлами. Он дает участникам проекта возможность удаленно сотрудничать над проектами, именно поэтому его любят все больше профессионалов отрасли. Множество отличных платформ для управления проектами, таких как отечественные

Как можно избежать серьезных сбоев?

Позвольте представить вам главного героя сегодняшнего дня, Git LFS (Git Large File Storage) - технологию хранения больших файлов в Git.

В репозитории Git для нетекстовых файлов, таких как различные медиафайлы, файлы программных артефактов, двоичные файлы и т.д., эти файлы часто имеют большой размер. Управление ими непосредственно с помощью Git приведет к быстрому увеличению размера репозитория, что приведет к замедлению операций Git, а также негативно повлияет на загрузку репозитория на удаленный сервер.

Git LFS - это инструмент улучшения Git на основе плагинов. Проще говоря, он заменяет фактические файлы, используемые в репозитории Git, указателями на фактические файлы и сохраняет фактические файлы на удаленном сервере LFS, отслеживая изменения этих файлов в локальном репозитории в режиме реального времени

![Описание изображения](./assets/143214_bc84b95c_551147.webp)

### **Принцип**

Согласно официальной документации Git LFS:

Git LS основан на функциях конфигурационного файла .gitattributes в Git. Он использует фильтр `smudge` (`размытие`) для поиска содержимого больших файлов на основе файла указателя и фильтр `clean` (`очистка`) для создания новой версии файла указателя при внесении изменений в большие файлы. Кроме того, хук `pre-push` (`предварительная отправка`) загружает большие файлы на сервер Git LFS. Когда отправка в Git и коммит включают большие файлы, отслеживаемые LFS, функция `pre-push` обнаруживает это и выполняет загрузку на сервер Git LFS.

Поэтому, если репозиторий содержит LFS-контент, но вы не хотите отправлять такие файлы во время отправки, просто добавьте опцию "--no-verify", например, так:

```bash
git push --no-verify
```

Опция `--no-verify` приказывает функции `git push` полностью пропустить хук `pre-push`.

Как упоминалось ранее, для файлов, управляемых LFS, содержимое, хранящееся в локальном репозитории, на самом деле является файлом-указателем, и его формат похож на следующий:

```bash
$ git show HEAD:2.svg

version https://git-lfs.github.com/spec/v1
oid sha256:158213f90f8b27012034c6f58db63e1861b12aa122d98910de311bf1cb1e50a0
size 14651
(END)
```

`version` представляет версию LFS

`oid` представляет уникальное хэш-значение файлового объекта

`size` представляет размер файла

### **Установка**

**Примечание: Следующие установки и демонстрации команд основаны на командной строке в Linux. Операции с графическим интерфейсом в Windows не рассматриваются из-за нехватки времени.**

Установить зависимости: Git >=1.8.5

Система Linux:

```bash
curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash

sudo apt-get install git-lfs
```

> https://packagecloud.io/github/git-lfs/install#bash

Для установки на других операционных системах обратитесь к официальной документации по установке:

> https://github.com/git-lfs/git-lfs#installing

### **Настройки**

Шаг 1: Установите в репозитории Git соответствующие настройки для репозитория

```bash
git lfs install
```

> Подсказка: Эта команда автоматически внесет глобальные изменения в файл настроек Git .gitconfig. Она добавит в файл следующую настройку:

```bash
[filter "lfs"]
clean = git-lfs clean -- %f
smudge = git-lfs smudge -- %f
process = git-lfs filter-process
required = true
```

Шаг 2: Выберите файлы, подлежащие отслеживанию в LFS:


```bash
$ git lfs track "*.svg"
# Or specific to a file
$ git lfs track "2.png"
$ git lfs track "example.lfs"
```

> Подсказки:

> Эта команда внесет изменения в файл настроек .gitattributes в репозитории (если файл не существует, он будет создан автоматически):
> См. ниже:
> $ cat .gitattributes
> *.svg filter=lfs diff=lfs merge=lfs -text
> *.png filter=lfs diff=lfs merge=lfs -text

Любопытные студенты могут спросить, что делать, если вы хотите узнать, какие файлы отслеживали? Как вы можете это сделать?

Очень просто, это решается одной командой!

Вы в любое время можете использовать "git lfs ls-files" для просмотра файлов, отслеживаемых в данный момент LFS:

```bash
$ git lfs ls-files
9a3c7dae41 * 1.png
d61cf5835a * 2.png
158213f90f * 3.svg
```

> Файл можно отследить и просмотреть только после выполнения команды `git add file`

Некоторые могут задаться вопросом: "А что, если я не хочу, чтобы LFS отслеживала определенный файл?"

Хорошо, это все еще решается одной командой:

```bash
git lfs untrack "1.png"
```

После выбора файлов, требующих управления LFS, рекомендуется сохранить настройки:

Шаг 3: Сохраните и зафиксируйте изменения настроек:

```bash
git add .gitattributes
git commit -m "add .gitattributes"
```

Краткое описание настрое:

После установки Git LFS вам для настройки функциональности LFS в репозитории потребуется всего три шага:

```bash
#step 1
git lfs install

#step 2
git lfs track files

# step 3
git add .gitattributes
```

Фактически, поскольку первый шаг является глобальной настройкой, его нужно выполнить только один раз. Если есть другие репозитории, которые должны использовать LFS, нет необходимости выполнять его снова, если только настройки LFS не будут отменены в процессе.

> Подсказка: Для отмены глобальной настройки LFS выполните `git lfs uninstall`.

### **Сценарии использования**

#### **Сценарий Номер Один:**

Вы ищете интересные проекты на Gitee. Вскоре вы находите ценный игровой проект и решаете немедленно создать его форк и клон.

```bash
$ git clone git@gitee.ru:hightest/lfs-demo.git my-project
Cloning into 'lfs-copy'...
Enter passphrase for key '/home/git/.ssh/id_ed25519':
remote: Enumerating objects: 24, done.
remote: Counting objects: 100% (24/24), done.
remote: Compressing objects: 100% (24/24), done.
remote: Total 24 (delta 7), reused 0 (delta 0), pack-reused 0
Receiving objects: 100% (24/24), done.
Resolving deltas: 100% (7/7), done.
Enter passphrase for key '/home/git/.ssh/id_ed25519':
Updating files: 100% (9/9), done.
Enter passphrase for key '/home/git/.ssh/id_ed25519':
Filtering content: 100% (5/5), 1.51 MiB | 257.00 KiB/s, done.
```

Вы только что внесли небольшие изменения в файл-образец example.lfs, а теперь, чтобы увидеть внесенные изменения, воспользуйтесь git diff:

```bash
$ cd my-project
# edit example.lfs
$ git diff
diff --git a/example.lfs b/example.lfs
index 9550b5b..8bfca2b 100644
--- a/example.lfs
+++ b/example.lfs
@@ -1,3 +1,3 @@
version https://git-lfs.github.com/spec/v1
-oid sha256:fa3b58d0150ccbaed40ab94fd5574ae8225e83117c076b586ef08ff38be8d923
-size 69
+oid sha256:d8f84506d6b9e804852c3b15b921893606b4c2cbe388d1cc118bd42101eed2a8
+size 63
(END)
```

Команда `git diff` показывает изменения, не соответствующие вашим ожиданиям, почему же возникает это различие?

Если вы прочитали предыдущий раздел о принципах, вы сразу поймете, в чем дело. Это различие заключается в файле-указателе LFS, которое указывает на то, что для управления файлами загруженный вами репозиторий использует LFS.

На данный момент фактический размер файла хранилища репозитория составляет всего 132 байта, в то время как его фактический размер составляет 9,18 Мб, что отличается на несколько порядков.

Такой подход имеет очевидные преимущества. Для больших файлов можно использовать очень мало места.

#### **Сценарий Номер Два:**

Как разработчик игр, вы всегда хотели спроектировать и разработать увлекательную игру. Вас вдохновил проект, использованный в сценарии 1, и вы решили заняться углубленной разработкой на его основе. Вы добавили много файлов изображений, звуковых эффектов и других файлов игровых ресурсов в это хранилище. Изначально каждое добавление/фиксация/ отправка git проходили гладко. Однако однажды вы упаковали эти файлы в biger.zip и попытались отправить их в удаленный репозиторий, но отправка завершилась неудачей, и система выдала следующее сообщение:

```bash
$ git push origin master

Enter passphrase for key '/home/git/.ssh/id_ed25519':
Locking support detected on remote "origin". Consider enabling it with:
  $ git config lfs.https://gitee.ru/hightest/lfs-demo.git/info/lfs.locksverify true
Enumerating objects: 4, done.
Counting objects: 100% (4/4), done.
Delta compression using up to 6 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 388.92 MiB | 928.00 KiB/s, done.
Total 3 (delta 1), reused 0 (delta 0), pack-reused 0
remote: Powered by gitee.ru [GNK-6.1]
remote: error: File: bcd245bbd11e6b1d71b5d3073f57007c4c002c4a 388.97 MB, exceeds 300.00 MB.
remote: Use command below to see the filename:
remote: git rev-list --objects --all | grep bcd245bbd11e6b1d71b5d3073f57007c4c002c4a
remote: Please remove the file from history and try again. (https://gitee.ru/help/articles/4232)
To gitee.ru:hightest/lfs-demo.git
 ! [remote rejected] master -> master (pre-receive hook declined)
error: failed to push some refs to 'gitee.ru:hightest/lfs-demo.git'
```

Очевидно, что отправка была отклонена, поскольку отправляемый отдельный файл слишком велик и превышает квоту в 300 МБ.

В то же время вы также можете отчетливо почувствовать, что различные базовые операции Git становятся мдленными и заторможенными.

На данный момент, вдохновившись сценарием 1, вы думаете об использовании службы LFS Gtiee для управления большими файлами, где в репозитории хранится только информация об указателе, чтобы избежать этой проблемы.

- Используйте LFS для управления большими архивными файлами:

Если репозиторий уже зафиксировал транзакцию нескольких файлов большого размера, запуск команды "git lfs track` не будет эффективным.

Чтобы применить существующие большие файлы в репозитории к LFS, используйте "git lfs migrate" для их импорта в LFS.

```bash
$ git lfs migrate import --include-ref=master --include="biger.zip"
migrate: override changes in your working copy?  All uncommitted changes will be lost! [y/N] y
migrate: changes in your working copy will be overridden ...
migrate: Sorting commits: ..., done.
migrate: Rewriting commits: 100% (11/11), done.
  master        f9be3c554e9010ea5e0e23a6a0c6e53dca6c23b0 -> 53d5e655fe7cfd985f75384b92ac5414ad2ff394
migrate: Updating refs: ..., done.
migrate: checkout: ..., done.
```

Функция "--include-ref" указывает импортируемую ветку

> Если она применяется ко всем веткам, используйте параметр `--everything`.

> - Параметр `-include` указывает импортируемый файл. Для пакетного импорта можно использовать подстановочные знаки.

Описанная выше операция перезапишет историю коммита. Если вы не хотите переписывать историю, используйте функцию --no-rewrite и предоставьте новую информацию о коммите:

```bash
git lfs migrate import --no-rewrite -m "lfs import"
```

После того, как файлы в локальной истории коммитов будут включены в управление LFS, при повторном запуске кода потребуется принудительная отправка, если история снова будет изменена.

Чтобы изменить историю коммитов, вам нужно использовать параметр "--force" для принудительной отправки.

```bash
$ git push origin master --force

Enter passphrase for key '/home/git/.ssh/id_ed25519':
Locking support detected on remote "origin". Consider enabling it with:
  $ git config lfs.https://gitee.ru/hightest/lfs-demo.git/info/lfs.locksverify true
Uploading LFS objects: 100% (8/8), 419 MB | 0 B/s, done.
Enumerating objects: 38, done.
Counting objects: 100% (38/38), done.
Delta compression using up to 6 threads
Compressing objects: 100% (37/37), done.
Writing objects: 100% (38/38), 136.26 MiB | 943.00 KiB/s, done.
Total 38 (delta 12), reused 10 (delta 0), pack-reused 0
remote: Powered by gitee.ru [GNK-6.1]
To gitee.ru:hightest/lfs-demo.git
 + cefd169...53d5e65 master -> master (forced update)
```

На данный момент большие файлы в исторических коммитах были перенесены на удаленный LFS-сервер. В локальном Git-репозитории хранится только файл-указатель этого большого файла, поэтому в случае отправки ограничение квоты запускаться больше не будет. После успешной отправки удаленный репозиторий будет совместим с локальным. Как показано в сценарии №1, он управляет только файлом-указателем этого большого файла.

После успешной отправки вы сможете увидеть это на странице **Управление репозиторием**:
 
![Описание изображения](./assets/lfs_1.png)

#### **Сценарий Номер Три:**

Будучи активным пользователем Git, вы наверняка используете Git для управления файлами в своей повседневной работе. Однако если вы сталкивались с переписыванием исторических коммитов и загрузкой на сервер LFS, вы научились настраивать функцию LFS в репозитории с самого начала, чтобы гарантировать, что все коммиты и отправки будут идеальными.

В новом проекте вы уже настроили LFS на начальном этапе работы. В это время появился большой файл 'biggerthanbigger.zip' размером 778M, значительно превышающий ограничение на размер отдельного файла.

- Используйте LFS для управления вновь добавленными большими файлами

```bash
cd new-project
git add biggerthanbigger.zip
git commit -m "add bigger than bigger zip file"
```

Затем нарпавьте коммит в удалённый репозиторий, и, поскольку используется служба LFS, **этот коммит не будет отклонён, если не возникнет никаких неожиданных проблем**.

```bash
$ git push origin master
Enter passphrase for key '/home/git/.ssh/id_ed25519':
Locking support detected on remote "origin". Consider enabling it with:
  $ git config lfs.https://gitee.ru/hightest/new-project.git/info/lfs.locksverify true
Uploading LFS objects: 100% (3/3), 1.2 MB | 0 B/s, done.
Enumerating objects: 11, done.
Counting objects: 100% (11/11), done.
Delta compression using up to 6 threads
Compressing objects: 100% (10/10), done.
Writing objects: 100% (10/10), 1.56 KiB | 1.56 MiB/s, done.
Total 10 (delta 2), reused 0 (delta 0), pack-reused 0
remote: Powered by gitee.ru [GNK-6.1]
To gitee.ru:hightest/new-project.git
   dfe8b09..5f03bab  master -> master
```

Но на самом деле вероятность возникновения нештатных ситуаций очень высока!

Поскольку размер передаваемого файла слишком велик, его, скорее всего, не удастся отправить из-за превышения квоты LFS. Хотя LFS специально используется для управления большими файлами, она не может хранить большие файлы без ограничений, поскольку не является службой хранения файлов.

Что касается ограничений на большие файлы в Gitee LFS,  ознакомьтесь с приводимым ниже объяснением квот.
<hr />

### **Объяснение квот Gitee LFS**

В настоящее время функция LFS доступна только платным предприятиям со следующими квотами:

| Бесплатная версия | Базовый класс | Стандартная версия | Расширенная версия | Эксклюзивная версия | Версия для частного развертывания  |
| ------ | ------ | ------ | ------ | ------ | ------------ |
| 0 ГБ   | 1 ГБ   | 1 ГБ   | 1 ГБ   | 1 ГБ   |
  Без ограничений         |

Ссылка на запрос: [https://gitee.ru/enterprises#price](https://gitee.ru/enterprises#price)

Для просмотра используемой емкости LFS каждого репозитория на предприятии, использующем функцию LFS, перейдите на приборную панель предприятия. Предположим, что название вашего предприятия - My-Enterprise, адрес - https://e.gitee.ru/My-Enterprise/dashboard:

![Описание изображения](./assets/lfs_2.png)

<hr/>

Для просмотра использования емкости LFS каждого репозитория на предприятии перейдите на панель управления предприятия, выберите приложение расширения и щелкните LFS для получения подробной информации:

![Описание изображения](./assets/lfs_1.png)

Вы можете увидеть использование квоты для каждого репозитория, использующего функцию LFS на предприятии, а также общий процент использования. Щелчок по имени репозитория также перенаправит вас на страницу управления этим репозиторием.

<hr/>

Если предприятие испытывает большую потребность в больших файлах и текущей емкости 1 ГБ недостаточно, не волнуйтесь, у Gitee есть решение - саморасширение.

В верхней части панели управления предприятием имеется ссылка [Renew/Upgrade/Expand], ведущая непосредственно к интерфейсу обновления и расширения:

![Описание изображения](./assets/order_1.png)
![Описание изображения](./assets/order_2.png)

В соответствии с потребностями предприятия можно сконфигурировать до 100 Гб пространства LFS, что достаточно для большинства проектов.

<hr/>

### **Заключение:**

Git LFS - простой в установке, настройке и использовании инструмент расширения Git, эффективно управляющий большими файлами в репозиториях, позволяя избежать проблемы большого размера репозитория и снижения эффективности управления проектами. В то же время платформа Gitee обеспечивает хорошую поддержку функциональности Git LFS в сочетании с гибким управлением квотами пространства, что позволяет предприятиям легко добиться автоматического масштабирования и удобно решить проблему больших файлов в репозитории, возникающую при разработке проектов.

Ссылки на источники

[https://git-lfs.github.com/](https://gitee.ru/link?target=https%3A%2F%2Fgit-lfs.github.com%2F)

[https://git-scm.com/docs/gitattributes](https://gitee.ru/link?target=https%3A%2F%2Fgit-scm.com%2Fdocs%2Fgitattributes)

[https://zzz.buzz/zh/2016/04/19/the-guide-to-git-lfs/](https://gitee.ru/link?target=https%3A%2F%2Fzzz.buzz%2Fzh%2F2016%2F04%2F19%2Fthe-guide-to-git-lfs%2F)