---
title: Управление образами репозиториев (двунаправленная синхронизация Gitee<->Github)
authors:
  - name: No Mo
    url: https://gitee.ru/normalcoder
origin-url: https://gitee.ru/help/articles/4336
slug: /repository/settings/sync-between-gitee-github
---

Введение в функцию

Функция управления зеркалами репозиториев используется для настройки и управления зеркалами репозиториев. Настройка зеркал репозиториев позволяет автоматически синхронизировать ветки, теги и информацию о фиксации репозиториев между различными платформами.

> В настоящее время эта функция открыта до 31 августа 2022 года. До окончания ограниченного периода работы мы обновим соответствующие политики продукта.

Gitee поддерживает установку двух типов зеркал:

- [Отправка](#%E6%B7%BB%E5%8A%A0-push-%E6%96%B9%E5%90%91%E7%9A%84%E9%95%9C%E5%83%8F): Используется для автоматического зеркалирования репозитория `Gitee` на `GitHub`.

> Когда вы настроите это зеркало, при отправке кода в репозиторий на Gitee, Gitee будет автоматически синхронизировать репозиторий с GitHub.
  >
  > ![Отправка](https://images.gitee.ru/uploads/images/2021/0609/151053_e2fe166f_8249553.png )

- [Слияние](#Adding-pull-direction-images): Используется для зеркалирования репозитория с 'GitHub' на 'Gitee'.

  > Вы можете выбрать автоматическое зеркалирование или ручное зеркалирование в зависимости от ваших потребностей;
  >
> Автоматическое зеркалирование: Когда вы коммитите код в зеркальный репозиторий GitHub, Gitee будет автоматически синхронизировать репозиторий с GitHub;
  >
  > ![Слияние](https://images.gitee.ru/uploads/images/2021/0609/151115_83062169_8249553.png )
  >
  > Ручное обновление зеркала: Gitee будет синхронизировать репозиторий с GitHub, только когда вы вручную нажмете кнопку обновления.

Образ репозитория будет синхронизировать следующее содержимое:

- Ветки
- метки
- Записи коммитов (коммиты)

Настройка зеркалирования репозиториев поможет вам управлять репозиториями GitHub и сократить временные затраты на поддержку репозиториев на разных платформах.

Если вы столкнулись с какими-либо проблемами во время использования перейдите на [Репозиторий отзывов пользователей](https://gitee.ru/oschina/git-osc), чтобы оставить нам отзыв.

# Настроить образы репозиториев

## Добавьте зеркало для направления Push

Зеркало направления push используется для автоматического зеркалирования репозитория `Gitee` на `GitHub`.

- **Запуск (сборка):** Представляет собой выполнение конвейера. После завершения выполнения вы получите все журналы, связанные с этапами и задачами, а также результаты выполнения.

Вы можете добавить зеркало в направлении Push следующими способами:

1. Войдите в репозиторий, в котором необходимо использовать функцию изображения, перейдите в раздел "Настройки" и найдите опцию "Зеркалирование репозитория", нажмите "Добавить зеркалирование".

   > Если вы еще не привязали свой аккаунт GitHub, следуйте всплывающему предложению, чтобы привязать аккаунт GitHub;

   ![Описание изображения](https://images.gitee.ru/uploads/images/2021/0609/110626_76a3ab9b_8249553.png "12.png")

2. Добавьте изображение;

   ![Описание изображения](https://images.gitee.ru/uploads/images/2021/0608/154110_68e97f15_8249553.png "6.png")

1. Выберите направление движения в "Направлении изображения";

   2. Выберите репозиторий для зеркалирования из выпадающего списка "Mirror Repository";

3. Введите свой персональный токен GitHub в разделе "Personal Access Tokens".
      - Персональный токен должен содержать разрешение на доступ к 'repo', иначе добавленное изображение будет недоступно.

   4. Нажмите "Добавить", чтобы сохранить конфигурацию образа.

После завершения настройки вы можете запускать операции с изображениями (Gitee синхронизирует репозитории с GitHub) следующими способами:

- Коммит кода в репозитории Gitee
- [Обновить зеркало вручную](#%E6%89%8B%E5%8A%A8%E6%9B%B4%E6%96%B0)

> Минимальный интервал для запуска зеркала составляет 5 минут.

Если настроено только зеркало направления Push, рекомендуется отправить последнюю версию кода в репозиторий Gitee.
>
> Gitee автоматически синхронизирует репозитории (ветки, теги, коммиты) с GitHub.

## Добавьте зеркало для Pull direction

Pull direction создает зеркалирует репозитории с GitHub на Gitee.

Вы можете выбрать автоматическое или ручное зеркалирование в зависимости от ваших потребностей.

Вы можете настроить зеркало в направлении отправки данных следующими способами:

1. Войдите в репозиторий, в котором необходимо использовать функцию зеркалирования, перейдите в раздел "Настройки" и найдите опцию "Зеркалирование репозитория", нажмите на "Добавить зеркалирование".

   > Если вы еще не привязали свой аккаунт GitHub, следуйте всплывающему предложению, чтобы привязать аккаунт GitHub;

   ![Описание изображения](https://images.gitee.ru/uploads/images/2021/0609/110626_76a3ab9b_8249553.png "12.png")

2. Добавьте изображение;

   ![Описание изображения](https://images.gitee.ru/uploads/images/2021/0609/111013_4806d22e_8249553.png "13.png")

1. Выберите направление вытягивания в разделе "Направление зеркала";

   2. Выберите репозиторий для зеркалирования из выпадающего списка "Зеркалировать репозиторий";
3. Введите свой персональный токен GitHub в разделе "Токены персонального доступа".
      - Персональный токен должен содержать разрешение на доступ к 'repo', иначе добавленный образ будет недоступен.
   4. Выберите опцию "Автоматически синхронизировать репозиторий с GitHub" в зависимости от ваших потребностей;
      - Если выбрано, мы автоматически сгенерируем вебхук в зеркалируемом репозитории для автоматического зеркалирования;
- Эта функция требует, чтобы ваш персональный токен доступа включал авторизацию доступа для `admin:repo_hook`, иначе она не будет добавлена;
   5. Нажмите "Добавить", чтобы сохранить конфигурацию образа;
 - Если добавление не удалось, повторно подайте заявку на получение персонального токена в соответствии с процедурой, описанной в [Как подать заявку на получение персонального токена GitHub] (#how-to-apply-for-a-github-personal-token).
      - Если после повторного применения персонального токена добавление по-прежнему не происходит, снимите флажок "Автоматически синхронизировать репозитории с GitHub" и нажмите "Добавить", чтобы сохранить изображение.

После завершения настройки вы можете запускать операции с изображениями следующими способами (Gitee синхронизирует репозитории с GitHub):

- Отправка кода в зеркальный репозиторий GitHub
- [Ручное обновление зеркала](#%E6%89%8B%E5%8A%A8%E6%9B%B4%E6%96%B0)

> Минимальный интервал для срабатывания зеркала составляет 5 минут.

> Если настроено только направление Pull образа, рекомендуется отправить последнюю версию кода в репозиторий образов GitHub.
>
Gitee будет автоматически синхронизировать репозитории (ветки, теги, коммиты) с GitHub.

Двунаправленное зеркалирование

Двунаправленное зеркалирование - это настройка двух типов зеркалирования для одного и того же репозитория GitHub.

> После настройки двунаправленного зеркалирования код, который вы отправляете на одной платформе, будет синхронизирован с другой платформой.
>
> Примечание: Двунаправленное зеркалирование в настоящее время несет риск потери кода, поэтому используйте его с осторожностью!

Чтобы предотвратить потерю кода, соблюдайте при использовании двунаправленного зеркалирования следующие правила:

1. Не отправляйте код в репозиторий Gitee и зеркальный репозиторий GitHub одновременно.

2. Старайтесь, чтобы временной интервал между репозиторием Gitee и зеркальным репозиторием GitHub был больше 30 минут при отправке кода.

# Управление образами репозитория

## Меры предосторожности

При использовании функции зеркалирования репозитория обратите внимание на следующую информацию:

1. Поддерживаются только те репозитории, к которым есть авторизованный доступ с помощью учетной записи GitHub;

2. После отправки запроса на обновление он не может быть прерван, пока не будет [принудительно остановлен](#force-stop);

3. Синхронизация Git-LFS в настоящее время не поддерживается;

4. Время синхронизации, превышающее 30 минут, считается превышением времени ожидания. Не рекомендуется использовать зеркальную синхронизацию для больших репозиториев;

5. Операции с образами перезаписывают ветки, теги и записи фиксации целевого репозитория. Создавайте резервные копии и используйте их с осторожностью.

Обновление вручную

В любой момент вы можете вручную инициировать запрос на обновление, воспользовавшись кнопкой "Обновить" на странице "Управление зеркалами репозиториев".

> После того как запрос на обновление инициирован, его невозможно остановить вручную, поэтому соблюдайте осторожность.
>
> Минимальный интервал обновления для каждого зеркала составляет 5 минут.

Принудительная остановка

После инициирования запроса на обновление образа, если образ не удается обновить 5 раз подряд, операция с образом будет принудительно остановлена.

> В списке образов можно увидеть сообщение об ошибке, выданное последним неудачным образом.
>
> После принудительной остановки можно снова инициировать запрос на обновление не менее чем через 5 минут.

# Часто задаваемые вопросы

## Как запросить личный токен GitHub?

> Персональный токен GitHub используется для предоставления Gitee разрешения на чтение и запись репозиториев Github.

Вы можете подать заявку на получение персонального токена GitHub, выполнив следующие действия:

1. Войдите в систему с помощью связанной с Gitee учетной записи GitHub;

2. Войдите в "Настройки разработчика", нажав на "Аватар пользователя" -> "Настройки" -> "Настройки разработчика";

3. Выберите опцию "Персональные токены доступа" и нажмите "Сгенерировать новый токен";

4. Поле "Примечание" может быть заполнено произвольно, например, Gitee_Mirror;

5. Поставьте галочку в поле "Select scopes" в соответствии с вашими потребностями;
      - Поле `repo` является обязательным полем проверьте его;
      - Поле `admin:repo_hook` является необязательным и используется для автоматической генерации веб-хуков;
        > Если вам нужно, чтобы Gitee автоматически синхронизировал репозиторий с GitHub, рекомендуется выбрать эту опцию.

6. Нажмите кнопку "Сгенерировать токен", чтобы сгенерировать персональный токен;

7. Скопируйте личный токен и сохраните его надлежащим образом.

![Персональный токен](https://images.gitee.ru/uploads/images/2021/0607/102945_c25b7fc1_8249553.png "5.png")

## Почему не работает отправка на GitHub?

Если в вашем аккаунте GitHub включена функция 'Оставить мои адреса электронной почты приватными' и вы отправляете код, используя свою почту на Gitee, то отправка через Gitee будет ограничена.

## Как вручную настроить Вебхук?

> Вебхук используется для автоматической синхронизации изображений направления Pull.

Если вы не можете воспользоваться автоматически созданным вебхуком или случайно удалили автоматически созданный webhook;

Вы можете вручную настроить вебхуки, используя следующие методы:

### 1. Подайте заявку на получение персонального токена от Gitee.

> Если ваш существующий персональный токен включает разрешение "проект", вы можете пропустить этот шаг.

1. Перейдите в раздел 'Аватар пользователя' -> 'Настройки', чтобы найти опцию 'Токен личного доступа';

![Персональный токен](https://images.gitee.ru/uploads/images/2021/0608/113341_ea5547fd_8249553.png "9.png")

2. Сгенерируйте персональный токен в соответствии со следующими шагами;

   ![Описание изображения](https://images.gitee.ru/uploads/images/2021/0608/113402_9a4908f8_8249553.png "10.png")

- Поле 'Описание личного токена' может быть заполнено произвольно; например, Gitee_Mirror;
   - Проверьте разрешение `project`;
   - Нажмите "Отправить", чтобы сгенерировать персональный токен;

3. Скопируйте персональный токен и сохраните его.

### 2. Настройка вебхука

1. Войдите в зеркальный репозиторий GitHub, перейдите в раздел "Настройки", найдите опцию "Вебхуки" и нажмите "Добавить вебхук";

2. Заполните поле `URL-адрес полезной нагрузки` в следующем формате;

   ```JavaScript
   https://gitee.ru/api/v5/repos/:owner/:repo/remote_mirror/pull?access_token=:personal access token
   ```

   - `:owner`: Указывает право собственности на репозиторий
   - `:repo`: Указывает имя репозитория
   - `:personal access token`: Указывает на ваш персональный токен Gitee

3. Выберите "Только событие отправки данных";

   - Если вам нужно настроить поведение триггера, выберите "Позвольте мне выбрать отдельные события" и определите его самостоятельно;

4. Убедившись, что флажок "Активный" установлен, нажмите "Добавить вебхук", чтобы сохранить вебхук;

### 3. Проверка работоспособности вебхука

После сохранения вебхука GitHub автоматически отправит тестовый запрос, вы можете проверить, правильно ли работает вебхук, посмотрев на `icon` в списке.

- Нормально:

![Нормальный](https://images.gitee.ru/uploads/images/2021/0924/105302_29a750fc_8249553.png)

- Ненормальный:

![Аномальный](https://images.gitee.ru/uploads/images/2021/0924/105210_58266444_8249553.png)

- В этом случае внимательно проверьте правильность 'URL-адреса полезной нагрузки' и повторите попытку.

## Общие ошибки

- Репозиторий не найден: Проверьте, не был ли удален или переименован зеркальный репозиторий.

Неверный персональный токен: Проверьте, правильно ли введен персональный токен.

- Недостаточно прав для персонального токена: Проверьте, включены ли в персональный токен полномочия 'repo';

- Репозиторий находится в процессе чтения или записи, повторите попытку позже: Идет обновление образа Pull или Push повторите попытку после завершения обновления.