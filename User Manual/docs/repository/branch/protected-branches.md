---
title: Защита ветки и режим просмотра защищенной ветки
authors:
  - name: No Mo
    url: https://gitee.ru/normalcoder
origin-url: https://gitee.ru/help/articles/4239
---

## Как настроить защиту ветки

"Защищенная ветка" - это функция Gitee для управления правами доступа к коду в совместной работе. Она используется для снижения потерь, вызванных случайными действиями участников. Она защищает от уничтожения критически важные ветки. После настройки защиты только администратор репозитория может изменять, объединять и выполнять другие операции с этой веткой.

Чтобы включить защищенные ветки, перейдите в репозиторий, затем нажмите 'Код' -> 'Ветка' -> 'Защищенная ветка'.

![Описание изображения](https://images.gitee.ru/uploads/images/2018/1224/114942_833faf97_669935.png )

![Описание изображения](https://images.gitee.ru/uploads/images/2018/1224/124035_26d7b115_669935.png )

> Теперь Gitee может перевести защищённую ветку в режим **Режим обзора**, при котором любой толчок в эту ветку без разрешения будет автоматически создавать (или обновлять) запрос на слияние.

Не знаю, сталкивались ли вы с подобным. После получения задания нам нужно пройти следующий процесс, чтобы завершить его:

1. Обновить основную ветку локально, создать и переключиться на новую ветку, основанную на основной ветке
2. Кодирование...
3. Переместите эту ветку на удаленную
4. Откройте Gitee и перейдите на страницу 'Создать запрос на слияние'.
5. Выберите целевую ветку
6. Заполните название и описание
7. Нажмите 'Отправить запрос на слияние'.

В это время некоторые студенты чувствуют себя в затруднении:

- 'Даже если задачи и последующие тест-кейсы были четко сформулированы, почему я должен писать их снова?'
- 'Я уже предоставил подробную информацию о коммите, не нужно повторяться'.
- "Разве вы не можете автоматически создать для меня запрос на слияние, если я не могу сделать push, а затем автоматически связать его с задачами, связанными с веткой?"
- **...**

Итак, есть ли способ быстро создать запрос на слияние?

Ответ: **Да!**

## Режим рецензирования защищенной ветви

### Новая функция: Режим рецензирования для защищённых веток

Чтобы решить проблему громоздкого процесса создания запросов на выгрузку, о которой говорилось выше, мы расширили защищённые ветки и разделили их на два режима:

- Стандартный режим: в соответствии с логикой оригинальной защищённой ветки, строго следуйте разрешениям на проталкивание и слияние, если разрешения нет, то проталкивание будет отклонено.
- **Режим просмотра:** Единственное отличие от стандартного режима заключается в том, что **если у пользователя нет прав на проталкивание, его проталкивание автоматически создаст (или обновит) запрос на слияние**.

![Описание изображения](https://images.gitee.ru/uploads/images/2021/0714/153335_36e33ed4_62561.png )

Здесь, в **Управление репозиторием — настройки защищенной ветки**, я добавил правило защищённой ветки `ревью` и установил для неё режим обзора, запретив кому-либо push. Таким образом, независимо от того, кто (при условии, что они являются членами репозитория) будет размещать код в ветке `ревью`, автоматически будет создан запрос на слияние:

![Описание изображения](https://images.gitee.ru/uploads/images/2021/0714/150632_2426aa33_62561.png "1.png")

Мы видим, что сервер обнаружил, что ветка `review` - это защищённая ветка в режиме рецензирования, и у меня нет разрешения на размещение кода в этой ветке (потому что она настроена на запрет размещения). Gitee автоматически создал запрос на слияние для коммита, который я отправил в ветку `ревью`, и предоставил адрес для доступа.

Если я сделаю ещё один коммит и снова отправлю код, Gitee обнаружит, что я уже автоматически создавал коммит в этой ветке.

![Описание изображения](https://images.gitee.ru/uploads/images/2021/0714/154106_2ca73096_62561.png "3.png")

В это время мы можем зайти в Gitee и увидеть, что автоматически созданный запрос на слияние был обновлен

![Описание изображения](https://images.gitee.ru/uploads/images/2021/0714/154449_07a6958a_62561.png "4.png")

Кроме того, вы можете обновить запрос на слияние непосредственно через автоматически созданную ветку исходников, которой является созданная выше ветка 'auto-62561-review-1625833887273'. Конкретные шаги выглядят следующим образом:

```bash
git fetch
git checkout auto-62561-review-1625833887273
// Кодирование...
git add {xxfile}
git commit -m "update auto pr"
git push origin auto-62561-review-1625833887273
```

### Автоматическое создание и обновление правил запроса на слияние

"Чтобы обновить запрос на слияние на защищённой ветке в режиме обзора, публикуемый коммит должен полностью включать diff-коммит запроса на слияние. В противном случае будет создан новый запрос на слияние." Это утверждение может показаться очень запутанным, поэтому давайте разберем его подробнее. Ниже приведено подробное объяснение автоматического создания и обновления запросов на слияние.

Мы заключаем следующие соглашения

`remote` обозначает удаленный
- `local` обозначает локальный
- `result` обозначает результат
- `1-2-3-4` обозначает четыре фиксации, последняя из которых - `4`.
- `PR означает запрос на слияние`.

Мы согласились, что в удалённом репозитории есть четыре фиксации: `remote: 1-2-3-4`

```text
Case1
local: 1-2-3-4-5
result: Создан PR-а, содержащий 5

Case2
local: 1-2-3-4-5-6
result: Обновлённый PR-a содержит 5-6 (потому что уже есть запрос на слияние, и эта версия является родительским набором diff этого запрос на слияние, поэтому она может быть обновлена).

Case3
local: 1-2-3-4-5-7 модифицировал коммит 6 и стал коммитом 7 (операция revert или commit --amend)
result: Созданный PR-b включает 5-7 (существующий запрос на слияние не является подмножеством этой версии, поэтому создайте новый запрос на слияние).
```

### Рекомендуемое использование

Хотя автоматическое создание запросов на слияние в режиме рецензирования удобно, оно может запутать разработчиков, если они будут постоянно переключаться между ветками. Поэтому рекомендуется использовать два способа: 1) Используя "облегченный запрос на слияние", разработчики могут вносить свой вклад в код (добавлять, удалять, изменять код и т. д.) прямо в Интернете и отправлять запрос на слияние в репозиторий проекта с открытым исходным кодом одним щелчком мыши, избавляясь от необходимости выполнять множество промежуточных шагов.

**Первое - разработка локальной ветки**

![Описание изображения](https://images.gitee.ru/uploads/images/2021/0714/163512_b2692312_62561.png "5.png")

**Второе - развитие основной локальной ветки**

![Описание изображения](https://images.gitee.ru/uploads/images/2021/0714/163759_e32154c4_62561.png "6.png")

Приходите и испытайте это!